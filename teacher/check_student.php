<?php
include_once("../config/Database.php");
include_once("../class/UserLogin.php");
include_once("../class/Student.php");
include_once("../class/Utils.php");
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// Initialize database connection
$connectDB = new Database("phichaia_student");
$db = $connectDB->getConnection();

// Initialize UserLogin class
$user = new UserLogin($db);
$student = new Student($db);

// Fetch terms and pee
$term = $user->getTerm();
$pee = $user->getPee();

if (isset($_SESSION['Teacher_login'])) {
    $userid = $_SESSION['Teacher_login'];
    $userData = $user->userData($userid);

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏°‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞ class ‡πÅ‡∏•‡∏∞ room ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    $class = $‡πäuserData['Teach_class'];
    $room = $userData['Teach_room'];
} else {
    $sw2 = new SweetAlert2(
        '‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
        'error',
        '../login.php' // Redirect URL
    );
    $sw2->renderAlert();
    exit;
}

require_once('header.php');
?>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">
    <?php require_once('wrapper.php'); ?>
    <div class="content-wrapper">
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h5 class="m-0">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ</h5>
                    </div>
                </div>
            </div>
        </div>
        <section class="content">
            <div class="container mx-auto py-4">
                <?php
                // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ tab ‡∏à‡∏≤‡∏Å query string
                $tab = $_GET['tab'] ?? 'check';
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á array ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö mapping tab => ‡πÑ‡∏ü‡∏•‡πå
                $tabFiles = [
                    'check' => 'check_std.php',
                    'summary-class' => 'report_summary_class.php',
                    'overview' => 'report_overview.php'
                ];
                ?>
                <!-- Tabs -->
                <div class="flex border-b mb-6">
                    <a href="?tab=check" class="px-4 py-2 -mb-px font-semibold border-b-2 transition-all <?= $tab === 'check' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-blue-600' ?>">
                        üìã ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                    </a>
                    <a href="?tab=summary-class" class="px-4 py-2 -mb-px font-semibold border-b-2 transition-all <?= $tab === 'summary-class' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-green-600' ?>">
                        üìë ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô
                    </a>
                    <a href="?tab=overview" class="px-4 py-2 -mb-px font-semibold border-b-2 transition-all <?= $tab === 'overview' ? 'border-yellow-500 text-yellow-600' : 'border-transparent text-gray-500 hover:text-yellow-600' ?>">
                        üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
                    </a>
                </div>
                <div class="bg-white rounded-lg shadow p-6 mt-4">
                    <?php
                    // include ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≤‡∏° tab ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                    if (isset($tabFiles[$tab]) && file_exists($tabFiles[$tab])) {
                        include($tabFiles[$tab]);
                    } else {
                        echo '<div class="text-gray-600">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>';
                    }
                    ?>
                </div>
            </div>
        </section>
    </div>
    <?php require_once('../footer.php'); ?>
</div>
<?php require_once('script.php'); ?>
</body>
</html>
