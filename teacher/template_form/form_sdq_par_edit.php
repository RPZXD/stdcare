<?php
require_once '../../class/SDQ.php';
require_once '../../config/Database.php'; // Assuming this file initializes $db

$student_id = $_GET['student_id'] ?? '';
$pee = $_GET['pee'] ?? '';
$term = $_GET['term'] ?? '';


// Initialize SDQ class
// Initialize database connection
$connectDB = new Database("phichaia_student");
$db = $connectDB->getConnection();
$sdq = new SDQ($db);

// Fetch existing data
$existingData = $sdq->getSDQParData($student_id, $pee, $term);
$answers = $existingData['answers'] ?? [];
$memo = $existingData['memo'] ?? '';

// ...existing code defining $questions and $choices...
$questions = [
    ['q1', '‡∏â‡∏±‡∏ô‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏à‡∏∞‡∏ó‡∏≥‡∏ï‡∏±‡∏ß‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡∏â‡∏±‡∏ô‡πÉ‡∏™‡πà‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô', '‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á ü§ù'],
    ['q2', '‡∏â‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏¥‡πà‡∏á ‡∏â‡∏±‡∏ô‡∏ô‡∏±‡πà‡∏á‡∏ô‡∏≤‡∏ô‡πÜ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', '‡∏™‡∏°‡∏≤‡∏ò‡∏¥/‡πÑ‡∏Æ‡πÄ‡∏õ‡∏≠‡∏£‡πå ‚ö°'],
    ['q3', '‡∏â‡∏±‡∏ô‡∏õ‡∏ß‡∏î‡∏®‡∏£‡∏µ‡∏©‡∏∞ ‡∏õ‡∏ß‡∏î‡∏ó‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢‡∏ö‡πà‡∏≠‡∏¢‡πÜ', '‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå üòñ'],
    ['q4', '‡∏â‡∏±‡∏ô‡πÄ‡∏ï‡πá‡∏°‡πÉ‡∏à‡πÅ‡∏ö‡πà‡∏á‡∏õ‡∏±‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô (‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô ‡πÄ‡∏Å‡∏° ‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤ ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô)', '‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á ü§ù'],
    ['q5', '‡∏â‡∏±‡∏ô‡πÇ‡∏Å‡∏£‡∏ò‡πÅ‡∏£‡∏á ‡πÅ‡∏•‡∏∞‡∏°‡∏±‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏™‡∏µ‡∏¢', '‡πÄ‡∏Å‡πÄ‡∏£ üò†'],
    ['q6', '‡∏â‡∏±‡∏ô‡∏ä‡∏≠‡∏ö‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡∏â‡∏±‡∏ô‡∏ä‡∏≠‡∏ö‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏û‡∏±‡∏á', '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô üßç‚Äç‚ôÇÔ∏èüßç‚Äç‚ôÄÔ∏è'],
    ['q7', '‡∏â‡∏±‡∏ô‡∏°‡∏±‡∏Å‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ö‡∏≠‡∏Å', '‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á ü§ù'],
    ['q8', '‡∏â‡∏±‡∏ô‡∏Ç‡∏µ‡πâ‡∏Å‡∏±‡∏á‡∏ß‡∏•', '‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå üòñ'],
    ['q9', '‡πÉ‡∏Ñ‡∏£‡πÜ ‡∏Å‡πá‡∏û‡∏∂‡πà‡∏á‡∏â‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ç‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à', '‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á ü§ù'],
    ['q10', '‡∏â‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏°‡πà‡∏™‡∏∏‡∏Ç ‡∏ß‡∏∏‡πà‡∏ô‡∏ß‡∏≤‡∏¢', '‡∏™‡∏°‡∏≤‡∏ò‡∏¥/‡πÑ‡∏Æ‡πÄ‡∏õ‡∏≠‡∏£‡πå ‚ö°'],
    ['q11', '‡∏â‡∏±‡∏ô‡∏°‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏ô‡∏¥‡∏ó', '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô üßç‚Äç‚ôÇÔ∏èüßç‚Äç‚ôÄÔ∏è'],
    ['q12', '‡∏â‡∏±‡∏ô‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏∞‡πÄ‡∏•‡∏≤‡∏∞‡∏ß‡∏¥‡∏ß‡∏≤‡∏ó‡∏ö‡πà‡∏≠‡∏¢ ‡∏â‡∏±‡∏ô‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ', '‡πÄ‡∏Å‡πÄ‡∏£ üò†'],
    ['q13', '‡∏â‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç ‡∏ó‡πâ‡∏≠‡πÅ‡∏ó‡πâ‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ‡∏ö‡πà‡∏≠‡∏¢‡πÜ', '‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå üòñ'],
    ['q14', '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ ‡∏™‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡∏ä‡∏≠‡∏ö‡∏â‡∏±‡∏ô', '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô üßç‚Äç‚ôÇÔ∏èüßç‚Äç‚ôÄÔ∏è'],
    ['q15', '‡∏â‡∏±‡∏ô‡∏ß‡∏≠‡∏Å‡πÅ‡∏ß‡∏Å‡∏á‡πà‡∏≤‡∏¢ ‡∏â‡∏±‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ò‡∏¥', '‡∏™‡∏°‡∏≤‡∏ò‡∏¥/‡πÑ‡∏Æ‡πÄ‡∏õ‡∏≠‡∏£‡πå ‚ö°'],
    ['q16', '‡∏â‡∏±‡∏ô‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏ô‡πÄ‡∏Ñ‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏á‡πà‡∏≤‡∏¢', '‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå üòñ'],
    ['q17', '‡∏â‡∏±‡∏ô‡πÉ‡∏à‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤', '‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á ü§ù'],
    ['q18', '‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ß‡πà‡∏≤‡∏â‡∏±‡∏ô‡πÇ‡∏Å‡∏´‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏µ‡πâ‡πÇ‡∏Å‡∏á‡∏ö‡πà‡∏≠‡∏¢‡πÜ', '‡πÄ‡∏Å‡πÄ‡∏£ üò†'],
    ['q19', '‡πÄ‡∏î‡πá‡∏Å‡πÜ ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏µ‡∏¢‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏±‡∏á‡πÅ‡∏Å‡∏â‡∏±‡∏ô', '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô üßç‚Äç‚ôÇÔ∏èüßç‚Äç‚ôÄÔ∏è'],
    ['q20', '‡∏â‡∏±‡∏ô‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏≠‡∏≤‡∏™‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô (‡∏û‡πà‡∏≠ ‡πÅ‡∏°‡πà ‡∏Ñ‡∏£‡∏π ‡πÄ‡∏î‡πá‡∏Å‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô)', '‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á ü§ù'],
    ['q21', '‡∏â‡∏±‡∏ô‡∏Ñ‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥', '‡∏™‡∏°‡∏≤‡∏ò‡∏¥/‡πÑ‡∏Æ‡πÄ‡∏õ‡∏≠‡∏£‡πå ‚ö°'],
    ['q22', '‡∏â‡∏±‡∏ô‡πÄ‡∏≠‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô ‡∏ó‡∏µ‡πà‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô', '‡πÄ‡∏Å‡πÄ‡∏£ üò†'],
    ['q23', '‡∏â‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡πá‡∏Å‡∏ß‡∏±‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô', '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô üßç‚Äç‚ôÇÔ∏èüßç‚Äç‚ôÄÔ∏è'],
    ['q24', '‡∏â‡∏±‡∏ô‡∏Ç‡∏µ‡πâ‡∏Å‡∏•‡∏±‡∏ß ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏´‡∏ß‡∏≤‡∏î‡∏Å‡∏•‡∏±‡∏ß‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢', '‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå üòñ'],
    ['q25', '‡∏â‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏î‡∏µ', '‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á ü§ù'],
];

// ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
$choices = [
    '0' => '‚ùå ‡πÑ‡∏°‡πà‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏•‡∏¢',
    '1' => 'üòê ‡∏à‡∏£‡∏¥‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô',
    '2' => '‚úÖ ‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô',
];
?>

<form id="sdqEditForm" class="space-y-6">
    <input type="hidden" name="student_id" value="<?= htmlspecialchars($student_id) ?>">

    <div class="bg-emerald-500 border rounded-lg shadow-sm p-4 mb-4">
        <h2 class="text-lg font-semibold text-white">üéì ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
        <p class="text-white">‡∏ä‡∏∑‡πà‡∏≠: <?= htmlspecialchars($_GET['student_name'] ?? '') ?>  ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: <?= htmlspecialchars($_GET['student_no'] ?? '') ?>   ‡∏ä‡∏±‡πâ‡∏ô: ‡∏°.<?= htmlspecialchars($_GET['student_class'] ?? '') ?>/<?= htmlspecialchars($_GET['student_room'] ?? '') ?></p>
        <p class="text-white">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà <?= htmlspecialchars($term) ?> ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ <?= htmlspecialchars($pee) ?></p>
    </div>

    <div class="bg-blue-100 text-blue-800 px-4 py-3 rounded-md">
        üìã <strong>‡∏Ñ‡∏≥‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á:</strong> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤
    </div>

    <table class="w-full border-collapse border border-gray-300">
        <thead>
            <tr class="bg-blue-500 text-white text-center">
                <th class="border border-gray-300 px-4 py-2">‡∏Ç‡πâ‡∏≠</th>
                <th class="border border-gray-300 px-4 py-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</th>
                <th class="border border-gray-300 px-4 py-2">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</th>
            </tr>
        </thead>
        <tbody>
            <?php foreach ($questions as $index => [$id, $text, $category]): ?>
                <tr class="hover:bg-gray-50">
                    <td class="border border-gray-300 px-4 py-2 text-center"><?= ($index + 1) ?></td>
                    <td class="border border-gray-300 px-4 py-2">
                        <?= htmlspecialchars($text) ?> <span class="text-sm text-gray-500">[<?= $category ?>]</span>
                    </td>
                    <td class="border border-gray-300 px-4 py-2">
                        <div class="flex flex-col sm:flex-row gap-3">
                            <?php foreach ($choices as $value => $label): ?>
                                <label class="inline-flex items-center gap-2 px-3 py-2 border rounded-md cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="<?= $id ?>" value="<?= $value ?>" <?= isset($answers[$id]) && $answers[$id] == $value ? 'checked' : '' ?> required class="form-radio text-blue-600">
                                    <span><?= $label ?></span>
                                </label>
                            <?php endforeach; ?>
                        </div>
                    </td>
                </tr>
            <?php endforeach; ?>
        </tbody>
    </table>

    <div class="p-4 bg-white border rounded-lg shadow-sm hover:shadow-md transition">
        <p class="mb-2 font-semibold text-gray-800">
            ‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏≠‡∏Å‡∏≠‡∏µ‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? <span class="text-sm text-gray-500">[‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°]</span>
        </p>
        <textarea name="memo" rows="4" class="w-full border rounded-md p-2" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."><?= htmlspecialchars($memo) ?></textarea>
    </div>
    <input type="text" name="pee" value="<?= htmlspecialchars($pee) ?>" class="hidden">
    <input type="text" name="term" value="<?= htmlspecialchars($term) ?>" class="hidden">
    <input type="text" name="student_id" value="<?= htmlspecialchars($student_id) ?>" class="hidden">
</form>
